---
output:
  html_document: default
  pdf_document: default
---
Red Wine Quality Exploration by Samuel Duan
========================================================

```{r, echo = FALSE}
knitr::opts_chunk$set(
  fig.path = "README_figs/README-"
)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_Library}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(ggplot2)
library(memisc)
library(GGally)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_the_Data}
wqr<-read.csv("wineQualityReds.csv")
```

```{r echo=FALSE}
# the way to create an emply line between paragraphs:
# (space)(space)
# <br>(space)
# (empty line)
```

# Univariate Plots Section  
In this section, some preliminary exploration of the dataset is performed, 
including data set summary and histogram is plotted to show the distribution of 
each particular variable.  
<br>  

#### 0. Summary of the Data Set

```{r echo=FALSE, message=FALSE, warning=FALSE}
str(wqr)
```
This data set contains 1599 observations and 11 chemical attributes that could 
affect the wine quality.    
<br>    

#### 1. Histogram of wine quality
```{r echo=FALSE, Univariate_Plots}
ggplot(data=wqr, aes(x=quality))+geom_bar()
```
```{r echo=FALSE}
summary(wqr$quality)
```
As shown in the plot above that the mode of the wine quality is 5.  
<br>  

#### 2. Histogram of fixed acidity
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=fixed.acidity))+geom_histogram()
```
```{r echo=FALSE}
summary(wqr$fixed.acidity)
```
The distribution of fixed acidity is skewed to the right.  
<br>  

#### 3. Histogram of volatile acidity
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=volatile.acidity))+geom_histogram()
```
```{r echo=FALSE}
summary(wqr$volatile.acidity)
```
The distribution of volatile acidity is skewed to the right.  
<br>  

#### 4. Histogram of citric acid
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=citric.acid))+geom_histogram()
ggplot(data=wqr, aes(x=citric.acid))+geom_histogram()+scale_x_log10()
```
```{r echo=FALSE}
summary(wqr$citric.acid)
```
The distribution of citric acid is skewed to the right, and it seems to be 
multimodal. Thus, it is plotted on a log scale to explore any unseen features.  
<br>  

#### 5. Histogram of residual sugar
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=residual.sugar))+geom_histogram()
ggplot(data=wqr, aes(x=residual.sugar))+geom_histogram()+scale_x_log10()
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(wqr$residual.sugar)
```
Since the distriution of residual sugar is significantly skewed to the right and 
concentrated at the left, it is plotted on a log scale to explore explore any 
unseen features.  
<br>  

#### 6. Histogram of chlorides
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=chlorides))+geom_histogram()
ggplot(data=wqr, aes(x=chlorides))+geom_histogram()+scale_x_log10()
```
```{r echo=FALSE}
summary(wqr$chlorides)
```
Again, since the distriution of chlorides is significantly skewed to the right, 
it is plotted on a log scale to explore explore any unseen features.  
<br>  

#### 7. Histogram of free sulfur dioxide
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=free.sulfur.dioxide))+geom_histogram()
```
```{r echo=FALSE}
summary(wqr$free.sulfur.dioxide)
```

#### 8. Histogram of total sulfur dioxide
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=total.sulfur.dioxide))+geom_histogram()
```
```{r echo=FALSE}
summary(wqr$total.sulfur.dioxide)
```
Both the distributions of free and total sulfur dioxide are skewed to the right.  
<br>  

#### 9. Histogram of density
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=density))+geom_histogram()
```
```{r echo=FALSE}
summary(wqr$density)
```
While most of the other parameters are positively skewed, the distribution of 
density is quite symmetric.  
<br>  

#### 10. Histogram of pH value
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=pH))+geom_histogram()
```
```{r echo=FALSE}
summary(wqr$pH)
```
The distribution of pH value also is symmetric.  
<br>  

#### 11. Histogram of sulphates
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=sulphates))+geom_histogram()
```
```{r echo=FALSE}
summary(wqr$sulphates)
```

#### 12. Histogram of alcohol
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=alcohol))+geom_histogram()
```
```{r echo=FALSE}
summary(wqr$alcohol)
```
Both the distribution of sulphates and alcohol are skewed to the right.  
<br>  

# Univariate Analysis  
### What is the structure of your dataset?  
This data set contains 1599 observations and 11 chemical attributes  that could 
affect the wine quality. All of 11 chemical attributes  are numerical variables.  

Other observations:  
1. The distributions of density and pH value are symmetic while most of the
attributes  are skewed to the right.  
2. Most of the attributes  are unimodal distributions, but Citric acid's has
prominent peaks.  

### What is/are the main feature(s) of interest in your dataset?
The main features of interest after univariate analysis are density and pH
value, since they resemble the distribution of the quality.  

### What other features in the dataset do you think will help support your
investigation into your feature(s) of interest? 
Both the distributions of density and pH value are unimodal.  

### Did you create any new variables from existing variables in the dataset?  
No.  

### Of the features you investigated, were there any unusual distributions? 
Did you perform any operations on the data to tidy, adjust, or change the form
of the data? If so, why did you do this?   
Some of the attributes  (e.g. residual sugar, chlorides) have narrow 
distributions and are positively skewed. Thus, these qualities are plotted on
log scale to explore any hidden features.  

# Bivariate Plots Section  

#### 1. Boxplot: fixed.acidity vs quality
```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots}
ggplot(data=wqr, aes(x=quality, y=fixed.acidity))+geom_boxplot(aes(group=quality))
tapply(wqr$fixed.acidity, wqr$quality, summary)
```
No strong correlation is found between fixed acidity and quality.  
<br>  

#### 2. Boxplot: volatile.acidity vs quality
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=quality, y=volatile.acidity))+geom_boxplot(aes(group=quality))
tapply(wqr$volatile.acidity, wqr$quality, summary)
```
Volatile acidity and quality are negatively correlated.  
<br>  

#### 3. Boxplot: citric.acid vs quality
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=quality, y=citric.acid))+geom_boxplot(aes(group=quality))
tapply(wqr$citric.acid, wqr$quality, summary)
```
Citric acid and quality are positively correlated.  
<br>  

#### 4. Boxplot: residual.sugar vs quality
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=quality, y=residual.sugar))+geom_boxplot(aes(group=quality))
tapply(wqr$residual.sugar, wqr$quality, summary)
```
No strong correlation is found between residual sugar and quality.  
<br>  

#### 5. Boxplot: chlorides vs quality
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=quality, y=chlorides))+geom_boxplot(aes(group=quality))
tapply(wqr$chlorides, wqr$quality, summary)
```
No strong correlation is found between residual sugar and quality.  
<br>  

#### 6. Boxplot: free.sulfur.dioxide vs quality
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=quality, y=free.sulfur.dioxide))+geom_boxplot(aes(group=quality))
tapply(wqr$free.sulfur.dioxide, wqr$quality, summary)
```
No strong correlation is found between free sulfur dioxide and quality.  
<br>  

#### 7. Boxplot: total.sulfur.dioxide vs quality
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=quality, y=total.sulfur.dioxide))+geom_boxplot(aes(group=quality))
tapply(wqr$total.sulfur.dioxide, wqr$quality, summary)
```
No strong correlation is found between total sulfur dioxide and quality.  
<br>  

#### 8. Boxplot: density vs quality
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=quality, y=density))+geom_boxplot(aes(group=quality))
tapply(wqr$density, wqr$quality, summary)
```
A week and negative correlation is found between density and quality. Despite
both of the distributions of density and quality are symmetric, it does not
necessarily indicate they are highly correlated.  
<br>  

#### 9. Boxplot: pH vs quality
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=quality, y=pH))+geom_boxplot(aes(group=quality))
tapply(wqr$pH, wqr$quality, summary)
```
Similiar to the previous plot, a week and negative correlation is found between 
density and quality. Their resemblance does not lead to a strong correlation.  
<br>  

#### 10. Boxplot: sulphates vs quality
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=quality, y=sulphates))+geom_boxplot(aes(group=quality))
tapply(wqr$sulphates, wqr$quality, summary)
```
The correlation between Sulphates and quality are positive, yet weak.  
<br>  

#### 11. Boxplot: alcohol vs quality
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wqr, aes(x=quality, y=alcohol))+geom_boxplot(aes(group=quality))
tapply(wqr$alcohol, wqr$quality, summary)
```
The correlation between alcohol and quality are positive and strong.  
<br>  

#### 12. The correlation plot between chemical attributes  
```{r echo=FALSE, message=FALSE, warning=FALSE}
#pairs(data=wqr, ~ quality+volatile.acidity+citric.acid+density+pH+sulphates+alcohol)
df=wqr[c("quality", "fixed.acidity", "volatile.acidity", "citric.acid", 
         "residual.sugar", "chlorides", "free.sulfur.dioxide", 
         "total.sulfur.dioxide", "density", "pH", "sulphates","alcohol")]
ggcorr(df, palette = "RdBu", label = TRUE)
#ggpairs(df, axisLabels = "internal")
```  

The correlation between chemical attributes are calculated to provide a 
quantitative insight on their relationship. Both this chart and the above 
boxplots draw the same conclusion: volatile acidity and alcohol show
stronger correlation with the wine quality. While the correlation between
sulphate and wine quality is 0.3, many outliers were found in the boxplot.  
<br>  

# Bivariate Analysis  

### Talk about some of the relationships you observed in this part of the \
investigation. How did the feature(s) of interest vary with other features in \
the dataset?   
1. When we explored the dataset by univariate plots, density and pH value are 
the only two attributes show symmetric distributions. At that time, it was 
suspected that they may have a stronger correlation with wine quality. 
2. However, as discussed briefly in the section of bavariate plots, volatile 
acidity and alcohol, rather than density and pH value show stronger correlation 
with the wine quality. 
3. Thus, the features of interest now are the votalie acidity and alcohol.  
  

### Did you observe any interesting relationships between the other features \
(not the main feature(s) of interest)?  
3 chemical attributes show strong correlation with fixed acidity (which is 
stronger than those with wine quality) and they are pH value, density and 
citric acid.  

### What was the strongest relationship you found?
Among the chemical attribute: (1) pH value and fixed acidity, (2) density and 
fixed acidity, (3) citric acid and fixed acidity  
Between the wine quality and a sole chemical attribute: alcohol and wine quality  
<br>

# Multivariate Plots Section

> **Tip**: Now it's time to put everything together. Based on what you found in
the bivariate plots section, create a few multivariate plots to investigate
more complex interactions between variables. Make sure that the plots that you
create here are justified by the plots you explored in the previous section. If
you plan on creating any mathematical models, this is the section where you
will do that.


```{r echo=FALSE, Multivariate_Plots}
wqr$newquality = ifelse(wqr$quality>5, 1, 0)
ggplot(wqr, aes(x=pH, y=fixed.acidity, group=newquality, colour=newquality)) + geom_point()
```
[Not sure which variables to choose to do the multivariate plots]
In this plot, I create a new variable to indicate the wine quality is high or
low. If wine quality is larger than 5, 1 is assigned, indicating high quliaty. 
If it is smaller than 5, 0 is assigned, indicating low quality. Then 
fixed acidity is plotted against pH value for both high and low quliaty. As 
shown in the plot, wine quality is in effect independent of the correlation 
between fixed acidity and pH value.


```{r echo=FALSE}
ggplot(wqr, aes(x=density, y=fixed.acidity, group=newquality, colour=newquality)) + geom_point()
```
```{r echo=FALSE}
ggplot(wqr, aes(x=citric.acid, y=fixed.acidity, group=newquality, colour=newquality)) + geom_point()
```
```{r echo=FALSE}
ggplot(wqr, aes(x=citric.acid, y=volatile.acidity, group=newquality, colour=newquality)) + geom_point()
```

Now I employ stepwise model selection to determine which chemical attributes
have an important role on the wine quality.
```{r echo=FALSE}
library(MASS)
fit <- lm(quality~fixed.acidity+volatile.acidity+citric.acid+residual.sugar
+chlorides+free.sulfur.dioxide+total.sulfur.dioxide+density+pH+sulphates
+alcohol, data=wqr)

stepfit <- step(fit, direction="both")
stepfit$anova # display results
```
According the result from the model selection, the amount of (1) volatile acidity, 
(2) chlorides, (3) free.sulfur.dioxide, (4) total.sulfur.dioxide, (5) pH, (6)
sulphates, and (7) alcohol would have an affect on the wine quality.

In the prior bivariate analysis, alcohol is the only attribute that shows strong
correlation with the wine quality. At first, it seems to be contray to the model
selection result. As I look into the model selection as shown below:                      
Df Sum of Sq    RSS     AIC
- citric.acid           1     0.475 667.54 -1380.8
<none>                              667.06 -1379.9
+ residual.sugar        1     0.257 666.81 -1378.5
+ fixed.acidity         1     0.133 666.93 -1378.2
+ density               1     0.028 667.03 -1378.0
- free.sulfur.dioxide   1     2.064 669.13 -1377.0
- pH                    1     7.138 674.20 -1364.9
- total.sulfur.dioxide  1     9.828 676.89 -1358.5
- chlorides             1     9.832 676.89 -1358.5
- sulphates             1    27.446 694.51 -1317.5
- volatile.acidity      1    35.977 703.04 -1297.9
- alcohol               1   122.667 789.73 -1112.0
the removal of alcohol would cause huge decrease in AIC value, while the removal
of others affect AIC less significantly. In fact, this list shows roughly the
importance of that attribute in determing the wine quality in an ascending order 
(that is from less important to more important)

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. Were there features that strengthened each other in terms of \
looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the \
strengths and limitations of your model.

------

# Final Plots and Summary

> **Tip**: You've done a lot of exploration and have built up an understanding
of the structure of and relationships between the variables in your dataset.
Here, you will select three plots from all of your previous exploration to
present here as a summary of some of your most interesting findings. Make sure
that you have refined your selected plots for good titling, axis labels (with
units), and good aesthetic choices (e.g. color, transparency). After each plot,
make sure you justify why you chose each plot by describing what it shows.

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection

> **Tip**: Here's the final step! Reflect on the exploration you performed and
the insights you found. What were some of the struggles that you went through?
What went well? What was surprising? Make sure you include an insight into
future work that could be done with the dataset.

> **Tip**: Don't forget to remove this, and the other **Tip** sections before
saving your final work and knitting the final report!